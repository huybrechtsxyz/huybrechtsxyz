# Build and Deploy Jobs
name: _BuildAndDeploy

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      initialize:
        required: true
        type: string
      rebuild:
        required: true
        type: string
    secrets:
      BITWARDEN_TOKEN:
        required: true

jobs:
  terraform:
    name: Terraform Swarm Cluster
    if: inputs.initialize == 'true'
    uses: ./.github/workflows/_task-terraform.yml
    with:
      environment: ${{ inputs.environment }}
    secrets:
      BITWARDEN_TOKEN: ${{ secrets.BITWARDEN_TOKEN }}
  
  initialize:
    name: Initialize Swarm Cluster
    needs: [terraform]
    if: inputs.initialize == 'true'
    uses: ./.github/workflows/_task-initialize.yml
    with:
      environment: ${{ inputs.environment }}
      tf_output_json: ${{ needs.terraform.outputs.tf_output_json }}
    secrets:
      BITWARDEN_TOKEN: ${{ secrets.BITWARDEN_TOKEN }}
