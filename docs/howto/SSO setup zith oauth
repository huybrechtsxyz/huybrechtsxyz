# üõ°Ô∏è SSO Setup with oauth2-proxy, Keycloak, and Google

This guide explains how to configure Single Sign-On in Docker Swarm using oauth2-proxy, Keycloak, and Google login.

---

## ‚ú® 1Ô∏è‚É£ Adding oauth2-proxy to Docker Compose / Swarm

**Example `docker-compose.yml` service:**

```yaml
services:
  oauth2-proxy:
    image: quay.io/oauth2-proxy/oauth2-proxy:v7.6.0
    networks:
      - traefik
    environment:
      - OIDC_ISSUER_URL=https://<KEYCLOAK_DOMAIN>/realms/<REALM>
      - OAUTH2_CLIENT_ID=<client-id>
      - OAUTH2_CLIENT_SECRET=<client-secret>
      - OAUTH2_COOKIE=<cookie-secret> # 16, 24 or 32 bytes base64 string
      - REDIRECT_HOST=auth.<domain>
      - COOKIE_DOMAIN=.dev.mycompany.local
      - WHITELIST_DOMAIN=.dev.mycompany.local
    command:
      - --provider=oidc
      - --oidc-issuer-url=$(OIDC_ISSUER_URL)
      - --client-id=$(OAUTH2_CLIENT_ID)
      - --client-secret=$(OAUTH2_CLIENT_SECRET)
      - --cookie-secret=$(OAUTH2_COOKIE)
      - --cookie-secure=true
      - --cookie-domains=$(COOKIE_DOMAIN)
      - --redirect-url=https://$(REDIRECT_HOST)/oauth2/callback
      - --scope=openid email profile
      - --session-store-type=cookie
      - --cookie-expire=8h
      - --cookie-refresh=1h
      - --skip-provider-button=true
      - --email-domain=*
    labels:
      - traefik.enable=true
      - traefik.http.routers.oauth2.rule=Host(`auth.<domain>`)
      - traefik.http.routers.oauth2.entrypoints=websecure
      - traefik.http.routers.oauth2.tls.certresolver=<resolver>
      - traefik.http.services.oauth2.loadbalancer.server.port=4180
